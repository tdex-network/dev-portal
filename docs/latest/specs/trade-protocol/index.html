<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-specs/trade-protocol">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="TDEX Network RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="TDEX Network Atom Feed"><title data-rh="true">BOTD#4: Trade | TDEX Network</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dev.tdex.network/img/tdex-og-image.png"><meta data-rh="true" name="twitter:image" content="https://dev.tdex.network/img/tdex-og-image.png"><meta data-rh="true" property="og:url" content="https://dev.tdex.network/docs/latest/specs/trade-protocol/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="BOTD#4: Trade | TDEX Network"><meta data-rh="true" name="description" content="The Trade protocol defines the public interface of a non-custodial exchange on top of an Elements-based chain such as Liquid Network."><meta data-rh="true" property="og:description" content="The Trade protocol defines the public interface of a non-custodial exchange on top of an Elements-based chain such as Liquid Network."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://dev.tdex.network/docs/latest/specs/trade-protocol/"><link data-rh="true" rel="alternate" href="https://dev.tdex.network/docs/latest/specs/trade-protocol/" hreflang="en"><link data-rh="true" rel="alternate" href="https://dev.tdex.network/docs/latest/specs/trade-protocol/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8554b61e.css">
<link rel="preload" href="/assets/js/runtime~main.8b4282f6.js" as="script">
<link rel="preload" href="/assets/js/main.57348e5c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/tdex-logo.png" alt="TDEX logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/tdex-logo.png" alt="TDEX logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Developer Portal</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/latest/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/latest/">latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/latest/specs/trade-protocol/">latest</a></li><li><a class="dropdown__link" href="/docs/v1/specs/trade-protocol/">1.0.0</a></li><li><a class="dropdown__link" href="/docs/v0/specs/trade-protocol/">0.9.1</a></li></ul></div><a href="https://github.com/tdex-network" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/latest/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/latest/specs/index/">Specifications</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/specs/index/">BOTD#0: Index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/specs/message-protocol/">BOTD#1: Message</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/specs/transport-protocol/">BOTD#2: Transport</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/specs/swap-protocol/">BOTD#3: Swap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/latest/specs/trade-protocol/">BOTD#4: Trade</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/specs/pool-protocol/">BOTD#5: Pool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/specs/CONTRIBUTING/">Contributing to TDEX Specifications</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/latest/trader/intro/">Trader</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/latest/provider/intro/">Liquidity Provider</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Specifications</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">BOTD#4: Trade</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: latest</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Trade protocol</h1><p>The Trade protocol defines the public interface of a non-custodial exchange on top of an Elements-based chain such as <a href="https://liquid.net" target="_blank" rel="noopener noreferrer">Liquid Network</a>. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>The centralized exchange main business is providing a venue for <em>traders</em> and <em>market makers</em> to register their offers to buy and sell in an order-book. In order to execute the orders, both are required to deposit funds and trust the exchange as custodian.  </p><p><strong>TDEX</strong> aims to create an open network that connects <em>traders</em> and <em>market makers</em> directly to each other, without the need of a centralized custodian, exploiting the atomic swap capability of Elements-based chains for executing trades in a trustless fashion.</p><p>The <strong>market makers</strong> provide always-on endpoints and put liquidity in various asset pairs forming a specified interface called <strong>Market</strong>.  Each <em>Market</em> holds reserves of a <strong>base asset</strong> and a <strong>quote asset</strong>.</p><p>Anyone can become a <strong>liquidity provider</strong> and contribute with reserves in a non-custodial manner running an always-on endpoint to process trading requests. This is different than buying or selling; it requires depositing an equivalent value of both base and quote assets and select an automated market making strategy. </p><p>A <strong>trader</strong> connects to the provider using the <a href="/docs/latest/specs/transport-protocol/">secure transport defined in the BOTD #2</a>, fetches the current <em>market price</em> defined by the provider&#x27;s strategy and makes an atomic swap using the <a href="/docs/latest/specs/swap-protocol/">swap protocol defined in the BOTD #3</a>. Limit orders could be supported as well, delaying the time of execution of the swap proposal in the future.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="trade">Trade<a class="hash-link" href="#trade" title="Direct link to heading">​</a></h2><ol><li>The <strong>Provider</strong> deposits two reserves for each asset forming a <em>Market</em>, defined as a pair of BASE ASSET and QUOTE ASSET, and expose a public reachable endpoint.</li><li>The <strong>Trader</strong> fetches from the <strong>Provider</strong> the list of supported pairs and linked provider&#x27;s fees.</li><li>The <strong>Trader</strong> passing a supported market in the request recognized by the hashes of two assets, fetches the current <strong>market rate</strong></li><li>The <strong>Trader</strong> proposes a new <strong>swap request</strong> using the price given and awaits for Provider&#x27;s response. The amounts in the swap request must not include the *<em>trading fees</em>, which must be explictly specified by the trader in the trade proposal message. The amounts in the swap request transaction, instead, must include the fees charged either on its inputs or outputs.</li><li>If the <strong>Provider</strong> accepts the terms will send back a <strong>swap accept</strong> message containing the partially signed transaction.</li><li>The <strong>Trader</strong> sends the signed transaction to finalize the trade using the <strong>swap complete</strong> message.</li><li>The <strong>Provider</strong> will finalize and broadcast the transaction to the network for on-chain settlement.</li></ol><blockquote><p>NOTICE: The Trader could skip point 6-7 and right away broadcast the transaction himself. Even if valid would be better for clients software to let the Provider be aware of the finalized transaction id rather than watch the blockchain to scan for known swaps.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-structures">Data Structures<a class="hash-link" href="#data-structures" title="Direct link to heading">​</a></h3><ul><li>Service Interface</li></ul><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">service TradeService {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rpc ListMarkets(ListMarketsRequest) returns (ListMarketsResponse) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    option (google.api.http) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post: &quot;/v2/markets&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rpc GetMarketBalance(GetMarketBalanceRequest) returns (GetMarketBalanceResponse) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    option (google.api.http) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post: &quot;/v2/market/balance&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      body: &quot;*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rpc GetMarketPrice(GetMarketPriceRequest) returns (GetMarketPriceResponse) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    option (google.api.http) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post: &quot;/v2/market/price&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      body: &quot;*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rpc PreviewTrade(PreviewTradeRequest) returns (PreviewTradeResponse) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    option (google.api.http) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post: &quot;/v2/trade/preview&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      body: &quot;*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rpc ProposeTrade(ProposeTradeRequest) returns (ProposeTradeResponse) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    option (google.api.http) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post: &quot;/v2/trade/propose&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      body: &quot;*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rpc CompleteTrade(CompleteTradeRequest) returns (CompleteTradeResponse) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    option (google.api.http) = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      post: &quot;/v2/trade/complete&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      body: &quot;*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Messages </li></ul><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">message ListMarketsRequest {}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message ListMarketsResponse { repeated MarketWithFee markets = 1; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetMarketBalanceRequest { Market market = 1; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetMarketBalanceResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Balance balance = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Fee fee = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetMarketPriceRequest { Market market = 1; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message GetMarketPriceResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  double spot_price = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 min_tradable_amount = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Balance balance = 3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message PreviewTradeRequest {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Market market = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  TradeType type = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 amount = 3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string asset = 4;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string fee_asset = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message PreviewTradeResponse { repeated Preview previews = 1; }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message ProposeTradeRequest {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Market market = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  TradeType type = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  SwapRequest swap_request = 3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 fee_amount = 4;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string fee_asset = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message ProposeTradeResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  SwapAccept swap_accept = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  SwapFail swap_fail = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 expiry_time_unix = 3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message CompleteTradeRequest {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  SwapComplete swap_complete = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  SwapFail swap_fail = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message CompleteTradeResponse {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string txid = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  SwapFail swap_fail = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Custom Types </li></ul><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">enum TradeType {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  TRADE_TYPE_BUY = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  TRADE_TYPE_SELL = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message Fee {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MarketFee percentage_fee = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MarketFee fixed_fee = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message MarketFee {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  int64 base_asset = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  int64 quote_asset = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message Balance {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 base_amount = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 quote_amount = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message Market {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string base_asset = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string quote_asset = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message MarketWithFee {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Market market = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Fee fee = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message Price {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  double base_price = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  double quote_price = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">message Preview {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Price price = 1;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Fee fee = 2;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 amount = 3;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string asset = 4;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Balance balance = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  uint64 fee_amount = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  string fee_asset = 6;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="glossary">Glossary<a class="hash-link" href="#glossary" title="Direct link to heading">​</a></h2><ul><li><p><strong>Liquidity Provider</strong>: Holds reserves of pegged Bitcoin (eg. L-BTC) and an associated Elements asset in his non-custodial wallet, running automated market-making strategies both with or without an oracle. Providers are incentivized to be always on and need to expose a public reachable endpoint either via clearnet or using a <a href="https://2019.www.torproject.org/docs/tor-onion-service.html" target="_blank" rel="noopener noreferrer">Onion hidden service</a></p></li><li><p><strong>Market</strong>: A single provider putting liquidity into an asset pair forms a market defines as <strong>BASE_ASSET-QUOTE_ASSET</strong>. Multiple markets can co-exist, although this is less beneficial for signaling offers to traders. </p></li><li><p><strong>Trader</strong>: Proposes new swaps using the provider&#x27;s market rate. A trader can come and go, he only needs to support the <a href="/docs/latest/specs/swap-protocol/">swap protocol defined in the BOTD #3</a> and he can swap between the two assets in the <strong>Market</strong> in either direction by adding to the liquidity reserve of one and withdrawing from the reserve of the other. Traders can either connect directly to a <strong>provider</strong> if they already know the endpoint.</p></li><li><p><strong>Pool</strong>: Providers can register into a distributed service mesh with other providers pooling together liquidity. This acts as a first responder for traders to lookup for provider&#x27;s aggregated offers. A provider could run alone OR in a pool, but not both at the same time with the same reserves.</p></li><li><p><strong>Automated Market Making</strong>: A liquidity provider has full control over the market making strategy to apply needed to calculate the <strong>market rate</strong> at which to accept trades. That being said, there is a possibility to apply an automated market-making relying only on the reserves balances and the amount requested by the trader, without the need to connect to an external price feed. One of the most famous algorithms is called <em>constant product market-making</em>. In short, this model generates a full order-book based on an initial price for the market. Every transaction that occurs on this market will adjust the prices of the market accordingly. It&#x27;s a basic supply and demand automated market making system. </p></li><li><p><strong>Trading fee</strong>: A small percentage of the amount of the trade can be taken out by the provider and added to the reserves, besides the network fees. Since the provider is conveniently in charge of paying network fees, and also to discourage low-amount trades, it could also charge an additional fixed fee amount to the trade to be partially reimbursed for this expense.  While the <em>BASE_ASSET-QUOTE_ASSET</em> reserve ratio is constantly shifting, fees make sure that the total combined reserve size increases with every trade.
Guaranteed arbitrage opportunities from price fluctuations should push a steady flow of transactions through the system and increase the amount of fee revenue generated.  On the trader side, he can decide to pay the trading fees in either the base or the quote asset of a market. When making a trade proposal, the fees must be explictly specified in the request message along with the swap request one. The swap request&#x27;s amounts must not include the trading fees while they must be charged to the amounts of the transaction. It is duty of both parties to make sure the amounts presented in the trade proposal request message match those of the transaction they cooperatively build, sign and broadcast.  The trading fees must be either added or substracted to amount_p/amount_r of the swap request depending on the trade type and the asset in which they are going to be payed.  The following table resume all possible cases:</p><table><thead><tr><th>Trade type</th><th>Fee asset</th><th align="center">How to charge</th></tr></thead><tbody><tr><td>BUY</td><td>base asset</td><td align="center">Subtract</td></tr><tr><td>BUY</td><td>quote asset</td><td align="center">Add</td></tr><tr><td>SELL</td><td>base asset</td><td align="center">Add</td></tr><tr><td>SELL</td><td>quote asset</td><td align="center">Subtract</td></tr></tbody></table></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/tdex-network/dev-portal/edit/master/docs/specs/04-trade-protocol.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/latest/specs/swap-protocol/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">BOTD#3: Swap</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/latest/specs/pool-protocol/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">BOTD#5: Pool</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#trade" class="table-of-contents__link toc-highlight">Trade</a><ul><li><a href="#data-structures" class="table-of-contents__link toc-highlight">Data Structures</a></li></ul></li><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">DOCS</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/latest/specs/index/">Specifications</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/latest/trader/intro/">Trader</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/latest/provider/intro/">Liquidity Provider</a></li></ul></div><div class="col footer__col"><div class="footer__title">COMMUNITY</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/tdexnetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">MORE</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/tdex-network" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 TDEX Network. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8b4282f6.js"></script>
<script src="/assets/js/main.57348e5c.js"></script>
</body>
</html>