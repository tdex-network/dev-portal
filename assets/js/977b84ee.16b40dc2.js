"use strict";(self.webpackChunkdev_portal=self.webpackChunkdev_portal||[]).push([[5390],{601:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/user-keys-bf94f5fd19fa23443ecccf24126a65b9.png"},1308:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var n=a(8168),r=(a(6540),a(5680));const o={slug:"tdex-terraform-deploy-aws",title:"Deploy a TDEX Daemon to AWS with Terraform",author:"Alexander K",author_title:"TDEX Contributor",tags:["terraform","automation","tdex","deploy"]},l=void 0,i={permalink:"/blog/tdex-terraform-deploy-aws",editUrl:"https://github.com/tdex-network/dev-portal/edit/master/blog/blog/2021-09-15-tdex-terraform-deploy-aws.md",source:"@site/blog/2021-09-15-tdex-terraform-deploy-aws.md",title:"Deploy a TDEX Daemon to AWS with Terraform",description:"Configure and run the TDEX box easily using Terraform automation.",date:"2021-09-15T00:00:00.000Z",formattedDate:"September 15, 2021",tags:[{label:"terraform",permalink:"/blog/tags/terraform"},{label:"automation",permalink:"/blog/tags/automation"},{label:"tdex",permalink:"/blog/tags/tdex"},{label:"deploy",permalink:"/blog/tags/deploy"}],readingTime:3.71,hasTruncateMarker:!0,authors:[{name:"Alexander K",title:"TDEX Contributor"}],frontMatter:{slug:"tdex-terraform-deploy-aws",title:"Deploy a TDEX Daemon to AWS with Terraform",author:"Alexander K",author_title:"TDEX Contributor",tags:["terraform","automation","tdex","deploy"]},prevItem:{title:"Liquid Bitcoin peg-in(s) in the browser!",permalink:"/blog/liquid-pegin-browser"}},s={authorsImageUrls:[void 0]},d=[{value:"Create a user and obtain AWS Keys",id:"create-a-user-and-obtain-aws-keys",level:3},{value:"Install Terraform",id:"install-terraform",level:3},{value:"Proceed with cloning and deployment",id:"proceed-with-cloning-and-deployment",level:3},{value:"Tor",id:"tor",level:3},{value:"Install and use TDEX-CLI on you local machine",id:"install-and-use-tdex-cli-on-you-local-machine",level:3},{value:"Deposit funds",id:"deposit-funds",level:3}],c={toc:d},p="wrapper";function u(e){let{components:t,...o}=e;return(0,r.yg)(p,(0,n.A)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Configure and run the TDEX box easily using Terraform automation. "),(0,r.yg)("h3",{id:"create-a-user-and-obtain-aws-keys"},"Create a user and obtain AWS Keys"),(0,r.yg)("p",null,"As a first step it is required to obtain AWS access and secret keys. Best practice is to create a new user in AWS IAM.\nPlease navigate to Services > IAM page > Add user.\nOpen the AWS IAM users page, and click on Add user. Provide user with name and select Programmatic access on the Access type section. "),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Add User",src:a(8404).A,width:"1014",height:"518"})),(0,r.yg)("p",null,"Next, make sure that your AWS account (access key) has all the required privileges to create EC2 instances and S3 access.\nPermissions you need: EC2 full, S3 full and VPC access."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Attach permissions",src:a(9918).A,width:"1035",height:"618"})),(0,r.yg)("p",null,"Once you add Permissions and Tags, click Create user. That will bring you to the latest page provided with AWS Access and Secret Keys.\nCopy your keys to a safe place and do not share them with anyone."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Attach permissions",src:a(601).A,width:"1036",height:"523"})),(0,r.yg)("p",null,"Check the documentation ",(0,r.yg)("a",{parentName:"p",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users_create.html"},"here")),(0,r.yg)("hr",null),(0,r.yg)("h3",{id:"install-terraform"},"Install Terraform"),(0,r.yg)("p",null,"Next step is to install Terraform on your machine.\nThe easiest way is to follow the official documentation ",(0,r.yg)("a",{parentName:"p",href:"https://www.terraform.io/docs/cli/install/apt.html"},"here"),".\nFor Debian and Ubuntu APT Packages, you can also follow this installation."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'$ curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -\n$ sudo apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"\n$ sudo apt install terraform\n')),(0,r.yg)("hr",null),(0,r.yg)("h3",{id:"proceed-with-cloning-and-deployment"},"Proceed with cloning and deployment"),(0,r.yg)("p",null,"Clone the TDEX Box repository and enter its directory. "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/tdex-network/tdex-box.git\ncd tdex-box\n")),(0,r.yg)("hr",null),(0,r.yg)("p",null,"On the AWS AMI Marketplace, find Ubuntu 20.04 public AMI, accessible in the region you are planing to deploy the service and copy its AMI ID. "),(0,r.yg)("p",null,"Once you have everything in place, just execute deploy.sh and it will prompt you for all the parameters in the same order provided above.\nSince it is good practice to have a backup enabled, please provide S3 bucket a name when deploying.\nPlease enter the parameters carefully. "),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Make sure you copy the IP address after the deployment is over."),"\nThis is your TDEX endpoint IP, and it can be accessed over port 9000."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ cd terabox/\n$ chmod +x deploy.sh\n$ ./deploy.sh\n")),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Deploy",src:a(3242).A,width:"772",height:"614"})),(0,r.yg)("h3",{id:"tor"},"Tor"),(0,r.yg)("p",null,"When executing deploy.sh, you can also setup your service behind Tor.\nYou can provide your own V3 Onion private key, or simply leave it empty in order to have the service to generate it for you. "),(0,r.yg)("p",null,"Connect to your Linux box over SSH and get onion endpoint."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ ssh -i ~/.ssh/key_location ubuntu@your.tdex.host.ip\n$ docker exec tor onions\n\n")),(0,r.yg)("p",null,"Once you have your Onion endpoint, please follow ",(0,r.yg)("a",{parentName:"p",href:"https://dev.tdex.network/docs/provider/registry"},"this")," tutorial on how to register your onion endpoint in the ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/TDex-network/tdex-registry"},"public TDEX registry ")),(0,r.yg)("h3",{id:"install-and-use-tdex-cli-on-you-local-machine"},"Install and use TDEX-CLI on you local machine"),(0,r.yg)("p",null,"TDEX is a CLI (GRPC client), that can be used to interact with a remote TDEX-daemon endpoint.\nWe need to init/configure tdex-cli, which is a way of authenticating to the remote running deamon.\nWhen configuring the service, we need to provide several things:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"tls_cert_path"),(0,r.yg)("li",{parentName:"ul"},"macaroons_path"),(0,r.yg)("li",{parentName:"ul"},"rpcserver (this will be IP of machine where tdex-box is deployed)")),(0,r.yg)("p",null,"To install TDEX CLI you need to run ",(0,r.yg)("strong",{parentName:"p"},"getCli.sh")," located in scripts folder. If installed successfully tdex-cli will print help menu."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ chmod +x terabox/scripts/getCli.sh\n$ sudo ./terabox/scripts/getCli.sh\n")),(0,r.yg)("p",null,"Once you have installed tdex-cli, you will need to download the TLS certificate and macaroons from your tdexd host machine in order to connect remotely. This command will download the whole tdexd/ folder which is a copy of your container deamon. "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$  scp -r user@your.tdex.host.ip:$HOME/tdex-box/tdexd .\n")),(0,r.yg)("p",null,"Configure the tdex-cli with downloaded macaroons and certificate, and add your remote endpoint IP. "),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"cert.pem is located at $HOME/tdex-box/tdexd/tls/cert.pem on the remote machine"),(0,r.yg)("li",{parentName:"ul"},"admin.macaroon is located at $HOME/tdex-box/tdexd/macaroons/admin.macaroon on the remote machine")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"# By default it looks for the daemon operator gRPC interface on localhost:9000\n# or on a remote machine\n$ tdex config init --rpcserver=tdex.remote.host.ip:9000 --tls_cert_path=./cert.pem --macaroons_path=./admin.macaroon\n##### OR you can use the config command to set your values\n$ tdex config\n$ tdex config set tls_cert_path ./cert.pem\n$ tdex config set macaroons_path ./admin.macaroon\n$ tdex config set rpcserver tdex.remote.host.ip \n\n\nAfter those are set, you can test the TDEX daemon\n$ tdex listmarket\n$ tdex help   <-- for more information and commands\n")),(0,r.yg)("p",null,"For more information ",(0,r.yg)("a",{parentName:"p",href:"https://dev.tdex.network/docs/provider/daemon/getting_started/configure_cli"},"how to configure and use the TDEX CLI")),(0,r.yg)("h3",{id:"deposit-funds"},"Deposit funds"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Done!")," Now you are ready to ",(0,r.yg)("a",{parentName:"p",href:"https://dev.tdex.network/docs/provider/daemon/deposit_funds"},"deposit funds")," to open a market and earn swap fees."))}u.isMDXComponent=!0},3242:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/deploy-3bf69430842f2fe5c689a7f8fe254acd.png"},5680:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>y});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=d(a),m=r,y=p["".concat(s,".").concat(m)]||p[m]||u[m]||o;return a?n.createElement(y,l(l({ref:t},c),{},{components:a})):n.createElement(y,l({ref:t},c))}));function y(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,l[1]=i;for(var d=2;d<o;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8404:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/add-user-11d882df7faae15f701edb54ee2ab67c.png"},9918:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/attach-perms-617d07e15336bce352380e648778a124.png"}}]);