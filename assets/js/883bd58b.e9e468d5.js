"use strict";(self.webpackChunkdev_portal=self.webpackChunkdev_portal||[]).push([[443],{1436:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>f,frontMatter:()=>r,metadata:()=>d,toc:()=>l});var a=t(8168),o=(t(6540),t(5680));const r={title:"Webhooks",sidebar_position:10},c=void 0,d={unversionedId:"provider/daemon/webhooks",id:"version-1.0.0/provider/daemon/webhooks",title:"Webhooks",description:"You can setup webhooks for your provider that are triggered whenever some specific event occurs during its lifecycle. A webhook is defined by the following info:",source:"@site/versioned_docs/version-1.0.0/provider/daemon/webhooks.md",sourceDirName:"provider/daemon",slug:"/provider/daemon/webhooks",permalink:"/docs/v1/provider/daemon/webhooks",draft:!1,editUrl:"https://github.com/tdex-network/dev-portal/edit/master/versioned_docs/version-1.0.0/provider/daemon/webhooks.md",tags:[],version:"1.0.0",sidebarPosition:10,frontMatter:{title:"Webhooks",sidebar_position:10},sidebar:"version-1.0.0/tutorialSidebar",previous:{title:"Price feeder",permalink:"/docs/v1/provider/daemon/feeder"},next:{title:"Registry",permalink:"/docs/v1/provider/registry"}},i={},l=[{value:"Add webhook",id:"add-webhook",level:2},{value:"List webhooks",id:"list-webhooks",level:2},{value:"Remove webhook",id:"remove-webhook",level:2},{value:"Event payload",id:"event-payload",level:2},{value:"TRADE_SETTLED",id:"trade_settled",level:3},{value:"ACCOUNT_DEPOSIT",id:"account_deposit",level:3},{value:"ACCOUNT_WITHDRAW",id:"account_withdraw",level:3},{value:"ACCOUNT_LOW_BALANCE",id:"account_low_balance",level:3}],s={toc:l},p="wrapper";function f(e){let{components:n,...t}=e;return(0,o.yg)(p,(0,a.A)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"You can setup webhooks for your provider that are triggered whenever some specific event occurs during its lifecycle. A webhook is defined by the following info:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"id")," - unique identifier assigned by the provider to a webhook when it's created and used to refer to it"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"endpoint")," - the endpoint triggered whenever an event occurs. The provider makes a POST request to this endpoint sending info about the occured event as payload message"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"secret")," - a secret used to generate the ",(0,o.yg)("a",{parentName:"li",href:"https://jwt.io/introduction"},"JWT token")," added as header to authenticate the request made by the provider"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"event")," - the event for which triggering the webhook")),(0,o.yg)("h2",{id:"add-webhook"},"Add webhook"),(0,o.yg)("p",null,"A webhook can be added to those handled by the daemon with:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"# Add a secured webhook triggered whenever a trade is settled.\n#\xa0Check tdex webhook --help to see all available events\n$ tdex webhook --endpoint http://localhost:8888/endpoint --secret secret --trade-settled-event\n\n# Add a non-secured webhook\n$ tdex webhook add --endpoint http://localhost:8888/endpoint --trade-settled-event\n")),(0,o.yg)("p",null,"The provider returns the id of the created webhook like for example ",(0,o.yg)("inlineCode",{parentName:"p"},"d6c0f4cc-d04f-4fcd-b6ba-45590e4ae099"),"."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"If you want to setup a webhook triggered whenever any kind of events is produced by the provider, you can use the ",(0,o.yg)("inlineCode",{parentName:"p"},"--any-event")," flag.")),(0,o.yg)("h2",{id:"list-webhooks"},"List webhooks"),(0,o.yg)("p",null,"You can list all webhooks, or fileter them by some specific event with:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"# List all webhooks\n$ tdex webhooks\n\n# List all webhooks filtered by events\n$ tdex webhooks --trade-settled-event\n")),(0,o.yg)("p",null,"Note that for security reasons you'll know wheter the webhooks are secured or not, but you won't be able to see their secrets eventually."),(0,o.yg)("h2",{id:"remove-webhook"},"Remove webhook"),(0,o.yg)("p",null,"You can remove a webhook by simply providing its id. If you don't remember its id, you can list the webhooks and recognize it by its endpoint."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex webhook remove --id d6c0f4cc-d04f-4fcd-b6ba-45590e4ae099\n")),(0,o.yg)("h2",{id:"event-payload"},"Event payload"),(0,o.yg)("p",null,"The provider can generate several events during its lifetime and you can get notified about them by setting up one or more webhooks. Here you can find the list of all events produced by the provider and the related payload message sent when making the request to a webhook's endpoint"),(0,o.yg)("h3",{id:"trade_settled"},"TRADE_SETTLED"),(0,o.yg)("p",null,"The daemon produces this event whenever a trade on some market has been included in blockchain. The payload message looks like the following example:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "event": "TRADE_SETTLED",\n  "market": {\n    "base_asset":  "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49",\n    "quote_asset": "f3d1ec678811398cd2ae277cbe3849c6f6dbd72c74bc542f7c4b11ff0e820958"\n  },\n  "balance": {\n    "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49": {\n      "unconfirmed": 0,\n      "confirmed": 57556016,\n      "locked": 0\n    },\n    "f3d1ec678811398cd2ae277cbe3849c6f6dbd72c74bc542f7c4b11ff0e820958": {\n      "unconfirmed": 0,\n      "confirmed": 376940871878,\n      "locked": 0\n    },\n  },\n  "price": {\n    "base_price":  0.00003462495088,\n    "quote_price": 28880.90739460\n  },\n  "swap": {\n    "amount_p": 142701,\n    "asset_p":  "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49",\n    "amount_r": 4179067300,\n    "asset_r":  "f3d1ec678811398cd2ae277cbe3849c6f6dbd72c74bc542f7c4b11ff0e820958"\n  },\n  "txid": "68790873e2e56a86844f367f9c3d64ebadc1c6d61d8cda6df0dff8010139ea95",\n  "settlement_timestamp": 1673797793,\n    "settlement_date": "2023-01-15T15:49:53Z",\n    "trading_fees": {\n    "asset":  "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49",\n    "amount": 1299,\n  }\n}\n')),(0,o.yg)("h3",{id:"account_deposit"},"ACCOUNT_DEPOSIT"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "event": "ACCOUNT_DEPOSIT",\n  "account": {\n    "type": "fee",\n    "name": "fee_account",\n  },\n  "balance": {\n    "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49": {\n      "unconfirmed": 13000,\n      "confirmed": 0,\n      "locked": 0\n    }\n  },\n  "txid": "b0ad86c8efcc4eadc74aab471196d7e0773f328ca7bb54dbe4eea1c7cf8c7445",\n    "amount_deposited": {\n    "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49": 13000\n    },\n}\n')),(0,o.yg)("p",null,"The daemon produces this event whenever a deposit transaction to some account gets included in mempool. The payload message looks like the following example:"),(0,o.yg)("h3",{id:"account_withdraw"},"ACCOUNT_WITHDRAW"),(0,o.yg)("p",null,"The daemon produces this event whenever a withdrawal transaction from some account gets included in mempool. The payload message looks like the following example:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "event": "ACCOUNT_WITHDRAW",\n  "account": {\n    "type": "market",\n    "base_asset": "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49",\n    "quote_asset": "f3d1ec678811398cd2ae277cbe3849c6f6dbd72c74bc542f7c4b11ff0e820958"\n  },\n  "balance": {\n    "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49": {\n      "unconfirmed": 10000,\n      "confirmed": 57456016,\n      "locked": 100000\n    },\n    "f3d1ec678811398cd2ae277cbe3849c6f6dbd72c74bc542f7c4b11ff0e820958": {\n      "unconfirmed": 0,\n      "confirmed": 376940871878,\n      "locked": 0\n    },\n  },\n  "txid": "b0ad86c8efcc4eadc74aab471196d7e0773f328ca7bb54dbe4eea1c7cf8c7445",\n    "amount_withdrawn": {\n    "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49": 90000\n    },\n}\n')),(0,o.yg)("h3",{id:"account_low_balance"},"ACCOUNT_LOW_BALANCE"),(0,o.yg)("p",null,"The daemon produces this event whenever the balances of ",(0,o.yg)("inlineCode",{parentName:"p"},"fee_account")," or a market go below under a certain threshold.\nThis threshold can be configured via envorinment variable for the former - by exporting ",(0,o.yg)("inlineCode",{parentName:"p"},"TDEX_FEE_ACCOUNT_BALANCE_THRESHOLD"),", which by default is set to 5000 sats of LBTC -, while for the latter you configure it when setting the fixed fees, that are reused here as base/quote asset balance threshold."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "event": "ACCOUNT_LOW_BALANCE",\n    "account": {\n        "type": "fee",\n    "name": "fee_account"\n    },\n    "balance": {\n    "144c654344aa716d6f3abcc1ca90e5641e4e2a7f633bc09fe3baf64585819a49": {\n      "unconfirmed": 0,\n      "confirmed": 4574,\n      "locked": 0\n    }\n  }\n}\n')))}f.isMDXComponent=!0},5680:(e,n,t)=>{t.d(n,{xA:()=>s,yg:()=>u});var a=t(6540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=a.createContext({}),l=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},s=function(e){var n=l(e.components);return a.createElement(i.Provider,{value:n},e.children)},p="mdxType",f={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},b=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),p=l(t),b=o,u=p["".concat(i,".").concat(b)]||p[b]||f[b]||r;return t?a.createElement(u,c(c({ref:n},s),{},{components:t})):a.createElement(u,c({ref:n},s))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,c=new Array(r);c[0]=b;var d={};for(var i in n)hasOwnProperty.call(n,i)&&(d[i]=n[i]);d.originalType=e,d[p]="string"==typeof e?e:o,c[1]=d;for(var l=2;l<r;l++)c[l]=t[l];return a.createElement.apply(null,c)}return a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);