"use strict";(self.webpackChunkdev_portal=self.webpackChunkdev_portal||[]).push([[3937],{4701:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var r=a(8168),n=(a(6540),a(5680));const o={title:"Manage a market",sidebar_position:2},i=void 0,s={unversionedId:"provider/daemon/market/manage_account",id:"version-0.9.1/provider/daemon/market/manage_account",title:"Manage a market",description:"Here below you can find a list with the description of all the other commands of the operator CLI to interact with a market account of your daemon's internal HD wallet.",source:"@site/versioned_docs/version-0.9.1/provider/daemon/market/manage_account.md",sourceDirName:"provider/daemon/market",slug:"/provider/daemon/market/manage_account",permalink:"/docs/v0/provider/daemon/market/manage_account",draft:!1,editUrl:"https://github.com/tdex-network/dev-portal/edit/master/versioned_docs/version-0.9.1/provider/daemon/market/manage_account.md",tags:[],version:"0.9.1",sidebarPosition:2,frontMatter:{title:"Manage a market",sidebar_position:2},sidebar:"version-0.9.1/tutorialSidebar",previous:{title:"Deposit funds",permalink:"/docs/v0/provider/daemon/market/deposit_funds"},next:{title:"Fee Fragmenter Account",permalink:"/docs/v0/provider/daemon/fee_fragmenter_account"}},l={},d=[{value:"Check the balance",id:"check-the-balance",level:2},{value:"List all derived addresses",id:"list-all-derived-addresses",level:2},{value:"Update the relative fee of the market",id:"update-the-relative-fee-of-the-market",level:2},{value:"Update the fixed fee of the market",id:"update-the-fixed-fee-of-the-market",level:2},{value:"Update the strategy of the market",id:"update-the-strategy-of-the-market",level:2},{value:"Update the price of the market",id:"update-the-price-of-the-market",level:2},{value:"Open the market",id:"open-the-market",level:2},{value:"Close a market",id:"close-a-market",level:2},{value:"List collected fees for trades on the market",id:"list-collected-fees-for-trades-on-the-market",level:2},{value:"Withdraw from market",id:"withdraw-from-market",level:2},{value:"Drop market",id:"drop-market",level:2}],c={toc:d},p="wrapper";function m(e){let{components:t,...a}=e;return(0,n.yg)(p,(0,r.A)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"Here below you can find a list with the description of all the other commands of the operator CLI to interact with a market account of your daemon's internal HD wallet."),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"At any time, you can obtain detaild info about all the markets created in the daemon with:"),(0,n.yg)("pre",{parentName:"admonition"},(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'$ tdex listmarkets\n# {\n#   "markets": [\n#       {\n#           "market": {\n#               "base_asset": "5ac9f65c0efcc4775e0baec4ec03abdde22473cd3cf33c0419ca290e0751b225",\n#               "quote_asset": "b33ddc389d5dabae5b8e371b535433b1c18505ecf656fce6ca8540c07ec2bde5"\n#           },\n#           "fee": {\n#               "basis_point": "25",\n#               "fixed": {\n#                   "base_fee": "600",\n#                   "quote_fee": "10000000"\n#               }\n#           },\n#           "tradable": false,\n#           "strategy_type": "PLUGGABLE",\n#           "account_index": "5",\n#           "price": {\n#               "base_price": 40000,\n#               "quote_price": 0.000025\n#           },\n#           "balance": {\n#               "base_amount": "100000000",\n#               "quote_amount": "4000000000000"\n#           }\n#       }\n#   ]\n# }\n'))),(0,n.yg)("h2",{id:"check-the-balance"},"Check the balance"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'$ tdex market balance\n# {\n#   "available_balance": {\n#       "base_amount": "100000000",\n#       "quote_amount": "4000000000000"\n#   },\n#   "total_balance": {\n#       "base_amount": "100000000",\n#       "quote_amount": "4000000000000"\n#   }\n# }\n')),(0,n.yg)("p",null,"This commands shows the available balance and the total balance for a market. The available balance takes into account only the UTXOs that are confirmed and not currently used as inputs of yet-to-be-broadcasted transactions, while the total balance takes into account all those UTXOs excluded before.",(0,n.yg)("br",{parentName:"p"}),"\n","In the example above all UTXOs are currently confirmed and not locked by any transaction."),(0,n.yg)("h2",{id:"list-all-derived-addresses"},"List all derived addresses"),(0,n.yg)("p",null,"It is possible to retrieve the list of all derived deposit addresses of a market account with:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'$ tdex market addresses\n# {\n#   "address_with_blinding_key": [\n#       {\n#           "address": "el1qq2gn3y2r5405dppjk2yc2tjg0zxxy35fr0y9lc3yyrnyf07ktuht0ymzrh8hnjwl62w9ws6jwl3yh40k8cd26wfc27sug3rmh",\n#           "blinding": "2fab376ffecbee0cb7b70794373be35c7b24340a2652f1a10c8200b04ab3eedb"\n#       },\n#       {\n#           "address": "el1qq092gt6vyda85eqmqk5xh6dmjujljvm5mjzurn9k36nu6f6veheqqyh3hgtlwpd0y70tdccf5ua395hugwjv2ccw237cl9tal",\n#           "blinding": "7eab1dea4e504bb90ff96e692393ecb55f9edf9e4c840cd820e24ef27f4a27b0"\n#       }\n#   ]\n# }\n')),(0,n.yg)("p",null,"It returns a list of all derived confidential addresseses and related private blinding keys."),(0,n.yg)("h2",{id:"update-the-relative-fee-of-the-market"},"Update the relative fee of the market"),(0,n.yg)("p",null,"The relative fee is a percentage fee added to or deducted from the counter amount of a trade proposal, depending on the type of the trade (BUY or SELL respectively). It is expressed in basis point (bp) and can assume values in the range ","[1, 9999]",", ie. from 0.01% to 99.99% of the traded amount.\nFor example, a trader selling LBTC on a LBTC-USDt market with a relative fee set to 100bp means that 1% of the receiving USDt amount is kept by the liquidity provider.\nInversely, a trader buying LBTC on a LBTC-USDt market with a relative fee set to 100bp means that the trader will have to pay 1% more of the USDt amount to be sent in order to pay the liquidity provider."),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex market percentagefee --basis_point 100\n")),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"When a market is created, by default the percentage fee is set to ",(0,n.yg)("inlineCode",{parentName:"p"},"250")," typically. This value is customizable via the ",(0,n.yg)("inlineCode",{parentName:"p"},"TDEX_DEFAULT_FEE")," env var before starting the daemon. If you plan to open several markets on your daemon all of them with the same percentage fee, consider exporting the environment variable instead of manually update it for every market with the operator CLI.")),(0,n.yg)("h2",{id:"update-the-fixed-fee-of-the-market"},"Update the fixed fee of the market"),(0,n.yg)("p",null,"Since your daemon will always pay for network fees, you may want to specify a fixed fee that will be charged to the trades so that the traders contribute indirectly to cover the fee amount of the transactions."),(0,n.yg)("p",null,"The fixed fee can be specified for both the base asset and the quote asset. When a market is created, this kind of fee is set to 0 for both assets."),(0,n.yg)("p",null,"To update it, you can run:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex market fixedfee --base_fee 600 --quote_fee 20000\n#\n# market fees have been updated\n")),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"The fixed fee is also used by the daemon as a way to discourage trades with very low amounts because it is used as the minimum amount allowed for amounts in a trade proposal in order to be accepted. Consider setting this to half or the whole typical fee amount (ie ~700 sats of LBTC per trade).")),(0,n.yg)("h2",{id:"update-the-strategy-of-the-market"},"Update the strategy of the market"),(0,n.yg)("p",null,"The AMM strategy defines how your daemon calculates the current price for a market. By default, when a market is created the strategy is set to ",(0,n.yg)("inlineCode",{parentName:"p"},"BALANCED"),", which is a strategy that uses the constant product formula. This means that the current price depends exclusively from the balances of your market and the counter amount for a trade proposal is calculated by keeping constant the product of the base and quote asset balances."),(0,n.yg)("p",null,"At the time of writing (v0.6.0), the daemon supports only another type of strategy which is named ",(0,n.yg)("inlineCode",{parentName:"p"},"PLUGGABLE"),". This strategy requires you to manually update the current base and quote price of the market, plugging in an external price feed that can be done by calling the ",(0,n.yg)("inlineCode",{parentName:"p"},"UpdateMarketPrice")," RPC of the Operator interface."),(0,n.yg)("p",null,"To update the strategy of your selected market run:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"# set the strategy to PLUGGABLE\n$ tdex market strategy --pluggable\n#\n# strategy has been updated\n\n# set the strategy to BALANCED\n$ tdex market strategy --pluggable=false\n#\n# strategy has been updated\n")),(0,n.yg)("admonition",{type:"tip"},(0,n.yg)("p",{parentName:"admonition"},"If you want to use an external price feed for your market instead of the BALANCES strategy, but you also don't want to periodically update the market price by hand, you may find the ",(0,n.yg)("a",{parentName:"p",href:"/docs/v0/provider/feeder/overview"},"TDEX Feeder")," a solution that fits your needs.")),(0,n.yg)("h2",{id:"update-the-price-of-the-market"},"Update the price of the market"),(0,n.yg)("p",null,"To manually update the price of the selected market run:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex market price --base_price 40000 --quote-price 0.000025\n#\n# price has been updated\n")),(0,n.yg)("h2",{id:"open-the-market"},"Open the market"),(0,n.yg)("p",null,"Your market is ready to be opened by running: "),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex market open\n#\n# market is open\n")),(0,n.yg)("p",null,"This command makes the market tradable, therefore it will be visibile by traders by calling the ListMarkets RPC of the public Trade interface of the daemon."),(0,n.yg)("h2",{id:"close-a-market"},"Close a market"),(0,n.yg)("p",null,"To close the market run:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex market close\n#\n# market is close\n")),(0,n.yg)("h2",{id:"list-collected-fees-for-trades-on-the-market"},"List collected fees for trades on the market"),(0,n.yg)("p",null,"You can get info about the fees collected by the daemon on the trades made with traders for the selected market:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'$ tdex market reportfee\n{\n    "collected_fees": [\n    ],\n    "total_collected_fees_per_asset": {\n    }\n}\n')),(0,n.yg)("p",null,"This command prints to stdout the list of collected fees per each trade and the sum of these fees per each asset of the market pair."),(0,n.yg)("p",null,"This command makes the market not tradable, therefore it won't be visibile by traders who call the ListMarkets RPC on the public Trade interface."),(0,n.yg)("h2",{id:"withdraw-from-market"},"Withdraw from market"),(0,n.yg)("p",null,"To withdraw funds from the market run:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"# withdraw from both asset pairs\n$ tdex-cli market withdraw --base_amount 1000000 --quote_amount 1000000000 --address AzpnfRDMibvBfrzzdnq4aDCpfvENqRqckXRxqNNSPvLGqvPoucsiWfxryZxXErpXkMWqkts8ooaqVAXB\n\n# withdraw only base asset amount\n$ tdex-cli market withdraw --base_amount 1000000 --address AzpnfRDMibvBfrzzdnq4aDCpfvENqRqckXRxqNNSPvLGqvPoucsiWfxryZxXErpXkMWqkts8ooaqVAXB\n\n# withdraw only quote asset amount\n$ tdex-cli market withdraw --quote_amount 1000000000 --address AzpnfRDMibvBfrzzdnq4aDCpfvENqRqckXRxqNNSPvLGqvPoucsiWfxryZxXErpXkMWqkts8ooaqVAXB\n")),(0,n.yg)("p",null,"This command returns the hash of the withdrawal transaction."),(0,n.yg)("h2",{id:"drop-market"},"Drop market"),(0,n.yg)("p",null,"To drop a market, hence to delete the market account associated with an asset pair, run:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ tdex market drop\n#\n# market is dropped\n")),(0,n.yg)("p",null,"This will reset the HD wallet account associated with the market's asset pair. Make sure you withdrew all the funds from the market before doing this operation."))}m.isMDXComponent=!0},5680:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>h});var r=a(6540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),d=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=d(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(a),u=n,h=p["".concat(l,".").concat(u)]||p[u]||m[u]||o;return a?r.createElement(h,i(i({ref:t},c),{},{components:a})):r.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:n,i[1]=s;for(var d=2;d<o;d++)i[d]=a[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);